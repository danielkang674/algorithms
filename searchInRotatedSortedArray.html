<script>
  var search = function (nums, target) {
    let left = 0;
    let right = nums.length - 1;
    while (left <= right) {
      const mid = Math.floor((left + right) / 2);
      const m = nums[mid];
      const l = nums[left];
      const r = nums[right];
      if (m === target) {
        return mid;
      }
      // Sorted
      if (l < r) {
        if (m > target) {
          right = mid - 1;
        } else {
          left = mid + 1;
        }
      }
      // rotated
      else if (r < l) {
        // at left pivot
        if (m > r) {
          if (target < l) {
            left = mid + 1;
          } else if (m < target) {
            left = mid + 1;
          } else if (m > target) {
            right = mid - 1;
          }
        }
        // at right pivot
        else if (m < l) {
          if (target > r) {
            right = mid - 1;
          } else if (target < m) {
            right = mid - 1;
          } else if (target > m) {
            left = mid + 1;
          }
        }
      } else if (r === l) {
        // same
        break;
      }
    }
    return -1;
  };
  let ans = search([4, 5, 6, 7, 0, 1, 2], 0);
  if (ans === 4) {
    console.log('test passed');
  } else {
    console.log(`Expected ${ans} to be 4`);
  }
  ans = search([4, 5, 6, 7, 0, 1, 2], 3);
  if (ans === -1) {
    console.log('test passed');
  } else {
    console.log(`Expected ${ans} to be -1`);
  }
  ans = search([1, 3], 3);
  if (ans === 1) {
    console.log('test passed');
  } else {
    console.log(`Expected ${ans} to be 1`);
  }
  ans = search([1, 3, 5], 5);
  if (ans === 2) {
    console.log('test passed');
  } else {
    console.log(`Expected ${ans} to be 2`);
  }
  ans = search([5, 1, 3], 5);
  if (ans === 0) {
    console.log('test passed');
  } else {
    console.log(`Expected ${ans} to be 0`);
  }
  ans = search([3, 1], 1);
  if (ans === 1) {
    console.log('test passed');
  } else {
    console.log(`Expected ${ans} to be 1`);
  }
  ans = search([4, 5, 6, 7, 8, 1, 2, 3], 8);
  if (ans === 4) {
    console.log('test passed');
  } else {
    console.log(`Expected ${ans} to be 4`);
  }
  ans = search([1, 3, 5], 1);
  if (ans === 0) {
    console.log('test passed');
  } else {
    console.log(`Expected ${ans} to be 0`);
  }
  ans = search([5, 1, 3], 3);
  if (ans === 2) {
    console.log('test passed');
  } else {
    console.log(`Expected ${ans} to be 2`);
  }
  ans = search([5, 1, 2, 3, 4], 1);
  if (ans === 1) {
    console.log('test passed');
  } else {
    console.log(`Expected ${ans} to be 1`);
  }
</script>